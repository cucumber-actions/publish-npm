name: 'Publish to NPM'
description: 'Publish an npm package from a package.json'
inputs:
  npm-token: 
    description: "Authentication token to use when publishing to NPM"
    required: true
  working-directory:
    description: "Path within the repo to the folder where the package.json file lives"
    required: false
    default: "."
runs:
  using: "composite"
  defaults:
    working-directory: ${{ inputs.working-directory }}
  steps:
    - name: write tempoarary project .npmrc
      run: |
        cat >.npmrc <<"END"
        //registry.npmjs.org/:_authToken=${NPM_TOKEN}
        END
      shell: bash
    - name: publish package
      run: |
        npm publish
      env:
        NPM_TOKEN: ${{ inputs.npm-token }}
      shell: bash
    - name: Remove temporary .npmrc file
      run: |
        rm .npmrc
      shell: bash